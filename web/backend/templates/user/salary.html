{include file="__TPL__/header.html" /}
<div id="userList">
    <form action="__CONTROL__/insertSalary_20170220" method="post" enctype="multipart/form-data" id="insertCommission" class="well form-horizontal">
        <table border=0 cellspacing=0 cellpadding=0 align=center width="100%">
            <tr>
                <td width=55 height=20 align="center"><input type="hidden" name="MAX_FILE_SIZE" value="2000000">文件： </td>
                <td height="16">
                    <input name="file" type="file"  value="浏览" >
                </td>
                <input name="laid" type="hidden" id="upload_laid">
                <td>
                    <input type="submit" value="导入(新)" name="upload">
                </td>
            </tr>
        </table>
    </form>

    <form action="__CONTROL__/insertSalary" method="post" enctype="multipart/form-data" id="insertCommission" class="well form-horizontal">
        <table border=0 cellspacing=0 cellpadding=0 align=center width="100%">
            <tr>
                <td width=55 height=20 align="center"><input type="hidden" name="MAX_FILE_SIZE" value="2000000">文件： </td>
                <td height="16">
                    <input name="file" type="file"  value="浏览" >
                </td>
                <input name="laid" type="hidden" id="upload_laid">
                <td>
                    <input type="submit" value="导入(旧)" name="upload">
                </td>
            </tr>
        </table>
    </form>
    <form action="__METH__" method="get" id="search-form">
        <table class="table well" style="margin-bottom:-18px;">
            <tr>
                <th></th>
                <th>姓名</th>
                <th>公司名称</th>
                <th>身份证号</th>
                <th>工号</th>
                <th>工资月份</th>
                <th>开始时间</th>
                <th>结束时间</th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <td></td>
                <td><input type="text" name="name" class="input-medium" value="{if value="$base.get.name|isset"}{$base.get.name|urldecode}{/if}"></td>
                <td><input type="text" name="company_name" class="input-medium" value="{if value="$base.get.company_name|isset"}{$base.get.company_name}{/if}"></td>
                <td><input type="text" name="id_number" class="input-medium" value="{if value="$base.get.id_number|isset"}{$base.get.id_number}{/if}"></td>
                <td><input type="text" name="job_number" class="input-medium" value="{if value="$base.get.job_number|isset"}{$base.get.job_number}{/if}"></td>
                <td><input type="text" name="salary_month" class="input-medium" value="{if value="$base.get.salary_month|isset"}{$base.get.salary_month}{/if}"></td>
                <td><input type="text" name="start_time" class="input-medium" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',autoPickDate:true})"></td>
                <td><input type="text" name="end_time" class="input-medium" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',autoPickDate:true})"></td>
                <td colspan="2">
                    <button type="submit" class="btn btn-success"><i class="icon-search icon-white"></i>&nbsp;&nbsp;查询</button>
                    <a id="reset" class="btn btn-info"><i class="icon-refresh icon-white"></i>&nbsp;&nbsp;重置</a>
                </td>
                <td></td>
                <script type="text/javascript">
                    $("select[select]").each(function(e,obj){

                        $(this).val($(this).attr('select'));
                    })
                    $('#reset').click(function(){

                        $('#search-form :input').val('');
                        $('#search-form').submit();
                    });
                </script>
            </tr>
        </table>
    </form>
    <table id="user-list" class="table">
        <tr>
            <th><input type="checkbox" class="select-all input-checkbox"></th>
            <th>记录id</th>
            <!--<th>用户id</th>-->
            <th>姓名</th>
            <!--<th>电话号码</th>-->
            <th>公司名称</th>
            <th>身份证号</th>
            <th>工号</th>
            <th>工资月份</th>
            <!--<th>基本工资</th>-->
            <th>应发工资</th>
            <th>扣款合计</th>
            <th>实发工资</th>
            <!--<th>年资</th>-->
            <!--<th>全勤奖</th>-->
            <!--<th>补贴合计</th>-->
            <!--<th>交通补贴</th>-->
            <!--<th>住房补贴</th>-->
            <!--<th>加班合计</th>-->
            <!--<th>中夜班费</th>-->
            <!--<th>奖金</th>-->
            <!--<th>季度奖</th>-->
            <!--<th>年终奖</th>-->
            <!--<th>补上月</th>-->
            <!--<th>档案费1</th>-->
            <!--<th>档案费2</th>-->
            <!--<th>缺勤扣款</th>-->
            <!--<th>其他扣款</th>-->
            <!--<th>代扣外包费</th>-->
            <!--<th>个社</th>-->
            <!--<th>公积金</th>-->
            <!--<th>住宿费</th>-->
            <!--<th>个税</th>-->
            <!--<th>工会费</th>-->
            <!--<th>开卡费</th>-->
        </tr>
        {foreach from="$salary" value="$salary"}
        <tr>
            <td><input type="checkbox" class="input-checkbox" name="id" value="{$salary.id}"> </td>
            <td>{$salary.id}</td>
            <!--<td>{$salary.uid}</td>-->
            <td>{$salary.name}</td>
            <!--<td>{$salary.phone}</td>-->
            <td>{$salary.company_name}</td>
            <td>{$salary.id_number}</td>
            <td>{$salary.job_number}</td>
            <td>{$salary.salary_month}</td>
            <!--<td>{$salary.basic_salary}</td>-->
            <td>{$salary.should_salary}</td>
            <td>{$salary.withhold_count}</td>
            <td>{$salary.really_salary}</td>
            <td><a href="__CONTROL__/more_salary?id={$salary.id}">查看更多</a></td>
            <!--<td>{$salary.seniority}</td>-->
            <!--<td>{$salary.attendance_bonus}</td>-->
            <!--<td>{$salary.subsidy_count}</td>-->
            <!--<td>{$salary.subsidy_transportation}</td>-->
            <!--<td>{$salary.subsidy_house}</td>-->
            <!--<td>{$salary.overtime_count}</td>-->
            <!--<td>{$salary.overtime_cost}</td>-->
            <!--<td>{$salary.prize}</td>-->
            <!--<td>{$salary.qr_prize}</td>-->
            <!--<td>{$salary.end_prize}</td>-->
            <!--<td>{$salary.last_month}</td>-->
            <!--<td>{$salary.file_cost1}</td>-->
            <!--<td>{$salary.file_cost2}</td>-->
            <!--<td>{$salary.absence_deductions}</td>-->
            <!--<td>{$salary.other_deductions}</td>-->
            <!--<td>{$salary.outsource_cost}</td>-->
            <!--<td>{$salary.jinpo}</td>-->
            <!--<td>{$salary.cpf}</td>-->
            <!--<td>{$salary.house_cost}</td>-->
            <!--<td>{$salary.tax}</td>-->
            <!--<td>{$salary.checkoff}</td>-->
            <!--<td>{$salary.open_card}</td>-->
        </tr>
        {/foreach}

        <tr class="well">
            <td><input type="checkbox" class="select-all input-checkbox"></td>
            <td class="opt" colspan="2">

                <a class="btn btn-mini btn-danger" action="del"><i class="icon-trash icon-white"></i> 删除</a>
            </td>
            <td colspan="9">{$page}</td>
        </tr>
    </table>
</div>
<div id="config-role" title="配置用户角色" class="hide">
    <form action="__CONTROL__/configUserRole" method="post">
        <table class="table">
            <tr>
                <?php
                        $l_role=formatLevelData2($role_list,array('rid','pid'));
                        function bulid_role($role)
                        {
                            $str='<ul>';
                foreach ($role as $value) {
                if(!empty($value['son_data'])){
                $str.='<li><label class="checkbox"><input type="checkbox" class="input-checkbox" name="rid[]" value="'.$value['rid'].'" />'.$value['title'].'</label>'.bulid_role($value['son_data']).'</li>';
                }else{
                $str.='<li><label class="checkbox"><input type="checkbox" class="input-checkbox" name="rid[]" value="'.$value['rid'].'">'.$value['title'].'</label></li>';
                }
                }
                $str.='</ul>';
                return $str;
                }
                ?>
                <th>角色：</th>
                <style type="text/css">
                    .role-level ul{
                        list-style: none;
                    }
                </style>
                <td class="role-level">
                    <input type="hidden" name="uid" id="config-uid" />
                    <?php echo bulid_role($l_role);?>
                </td>
            </tr>
        </table>
    </form>
</div>
<div id="dialog" style="z-idnex:999"></div>
<script type="text/javascript">
    $('.config-role').click(function(){
        $('#config-role .user').text($(this).attr('username'));
        $('#config-uid').val($(this).attr('uid'));
        var rid=$(this).attr('rid').split('#');
        $('#config-role :checkbox').each(function(){
            if(jQuery.inArray($(this).val(),rid)>=0){
                $(this).attr('checked',true);
            }else{
                $(this).attr('checked',false);
            }
        });

        $('#config-role').dialog({
            "width":"400",
            "modal":true,
            "buttons":{
                "修改":function(){
                    if($('#config-role :checked').length==0){
                        alert('必须为用户设置一个角色');
                        return false;
                    }
                    $('#config-role form').submit();
                }
            }
        });
        return false;
    });
    select_all('user-list');//全选
    //删除选中用户
    function delete_salary(arg){
        $.post('__CONTROL__/delete_salary',{id:arg.id},function(data){
            if(data==1){
                arg.checked_obj.parents('tr').fadeOut(function(){
                    arg.checked_obj.parents('tr').remove();
                });
            }
        },'html');
    }
    $('.opt a').click(function() {
        var _id_arr = [],
                _confirm_msg = '删除',
                _action = $(this).attr('action'),
                _fun = "delete_salary",//处理函数
                _type = "",
                _checked = $('#user-list :checkbox[name]:checked');
        if (_checked.length == 0) {
            alert("请选择你需要操作的用户!");
            return false;
        }
        _checked.each(function () {
            _id_arr.push($(this).val());
        });
        if(confirm("确定"+_confirm_msg+"选中用户？")){
            eval(_fun+"({id:_id_arr,checked_obj:_checked,a_type:_action})");
        }
        return false;
        });
    function verify_recruit(arg){
        $.post('__CONTROL__/verifyRecruit',{"recruit_id":arg.id,type:arg.a_type},function(data){
            if(data==1){
                window.location.reload();
            }
        },'html');
    }

    //禁止、解禁用户
    function ban_user(arg){
        $.post('__CONTROL__/banUser',{id:arg.id,type:arg.a_type},function(data){
            if(data==1){
                if(arg.a_type==1){
                    arg.checked_obj.parent().siblings('.status').html('<span class="warning" title="用户已被禁止">已禁止</span>');
                }else{
                    arg.checked_obj.parent().siblings('.status').html('<span class="success" title="">已开启</span>');
                }
            }
        },'html');
    }
    function delete_salary(arg){
        $.post('__CONTROL__/delete_salary',{"id":arg.id},function(data){
            if(data==1){
                arg.checked_obj.parents('tr').fadeOut(function(){
                    arg.checked_obj.parents('tr').remove();
                });
            }
        },'html');
    }
    $('.opt-item').click(function(){
        var _this=$(this),
                _name=_this.attr('c-name'),
                _id=_this.attr('href');
        $.post($(this).attr('href'),function(data){
            $('#dialog').html(data);
            $('#dialog').dialog({
                "title":_name+"用户资料",
                "width":"500",
                "height":"auto",
                "modal":true,
                "buttons":{
                    "确定":function(){
                        if(_this.attr('action')=='view'){
                            $(this).dialog("close");
                        }else{
                            $('#dialog form').submit();
                        }
                    }
                }
            });
        },'html');
        return false;
    });
</script>
</body>
</html>
